---
title: Allure и автотесты на API
date: 2013-05-06
categories:
tags:
- allure
- httpclient
- okhttp
- rest-assured
---
# ...
Что должно быть в allure отчете для API теста? 
Для тестов на web интерфейс большую ценность предоставляет скриншот браузера или видео. 
Для тестов на API это запрос и ответ. Кроме того, хорошо бы иметь способ быстро воспроизвести этот запрос.
Все это реализовано нами в [allure-java](https://github.com/allure-framework/allure-java).

# Как это работает
Большинство API клиентов поддерживает фильтры. Они нужны для логирования, добавляения кастомной аунтификации или любого другого изменения и получения запроса до его выполнения, а также получения и изменения ответа до валидации. 
Через механизм фильтров мы получаем готовый реквест и сам ответ для http клиентов.
В модуле allure-attachment заворачиваем в красивый java bean, попутно сформировав curl. и вставляем в аттач, чтобы можно было легко запрос воспроизвести :)

# Mustache
Прикрепляемый аттач представляет собой html, который рендерится из mustache темплейта. [Mustache](http://mustache.github.io/) — простейший шаблонизатор.
Это позволяет гибко настраивать аттач на любой вкус. 

# Стандартный template
Стандартный аттач выглядит так:

# Мой template
Мой аттач, с подцветкой кода выглядит так:

Его можно найти в примерах. Ссылка

Мы сделали поддержку аттачей для отчета для популярных http клиентов в [allure-java](https://github.com/allure-framework/allure-java):
 * [rest-assured](https://github.com/allure-framework/allure-java#rest-assured), 
 * [okhttp](https://github.com/allure-framework/allure-java#okhttp) 
 * httpclient

Как подключить эти фильтры можно посмотреть в примерах или документации, обычно это делается с помощью подключения зависимости и установкой фильтра в клиент.