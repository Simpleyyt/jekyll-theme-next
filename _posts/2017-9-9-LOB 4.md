---
title: LOB 4번 Write-up
date: 2017-9-9 9:35:00
categories: LOB
tags: LOB, goblin, orc
---

## LOB 4번

    [goblin@localhost goblin]$ ls
    orc  orc.c
    [goblin@localhost goblin]$ cat orc.c
    /*
            The Lord of the BOF : The Fellowship of the BOF
            - orc
            - egghunter
    */
    
    #include <stdio.h>
    #include <stdlib.h>
    
    extern char **environ;
    
    main(int argc, char *argv[])
    {
            char buffer[40];
            int i;
    
            if(argc < 2){
                    printf("argv error\n");
                    exit(0);
            }
    
            // egghunter
            for(i=0; environ[i]; i++)
                    memset(environ[i], 0, strlen(environ[i]));
    
            if(argv[1][47] != '\xbf')
            {
                    printf("stack is still your friend.\n");
                    exit(0);
            }
    
            strcpy(buffer, argv[1]);
            printf("%s\n", buffer);
    }

이제 소스가 슬슬 이상해진다.

첫줄에 있는 `extern char **environ`은 환경변수에 대한 리스트 포인터이다. 
이후에 `//egghunter`에서 for문을 돌리면서 NULL값이 나올 때까지 값을 모두 0으로 덮어씌운다. 따라서 환경변수를 사용할 수 없는 것이다.

