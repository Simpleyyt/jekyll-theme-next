---
title: Allure Attachments и автотесты на API
date: 2013-05-06
categories:
tags:
- allure
- httpclient
- okhttp
- rest-assured
---
# ...
Что должно быть в Allure отчете для API теста? 
Для тестов на web интерфейс большую ценность предоставляет скриншот браузера или видео. Этого достаточно, чтобы понять в чем проблема и воспроизвести ее в случае необходимости. 
Для тестов на API это запрос и ответ со всеми подробностями и в хорошо читаемом виде. Кроме того, хорошо бы иметь способ быстро воспроизвести этот запрос.
Все это реализовано нами в [allure-java](https://github.com/allure-framework/allure-java).

# Как это работает
Большинство API клиентов поддерживает фильтры. Они нужны для логирования, добавления кастомной аунтификации или любого другого изменения и получения запроса до его фиксации, а также получения и изменения ответа до валидации. 
Через механизм фильтров мы получаем готовый запрос и сам ответ для http клиентов. После этого извлекаем стартовую строку, заголовки и тело, которые передаем в соответствующий builder класс `HttpRequestAttachment` или `HttpResponseAttachment`, попутно сформировав `curl`, чтобы можно было легко запрос воспроизвести. 

# FreeMarker
Аттачи представляют собой html-ки, который рендерится из [FreeMarker](https://freemarker.apache.org/) шаблонов и данных которые мы получили. Подробнее как это происходит можно посмотреть в модуле `allure-attachment`. 
Использование шаблонизатора позволяет гибко настраивать аттач на любой вкус. 

## Стандартный template
Стандартный аттач выглядит так:


## Мой template
Мои аттачи, с подцветкой кода, выглядит так:

Их можно найти в папке [examples](https://github.com/allure-framework/allure-java/tree/master/examples/rest-assured/src/test/resources/tpl).

Мы сделали поддержку аттачей для отчета для популярных http клиентов в [allure-java](https://github.com/allure-framework/allure-java):
 * [rest-assured](https://github.com/allure-framework/allure-java#rest-assured), 
 * [okhttp](https://github.com/allure-framework/allure-java#okhttp) 
 * httpclient

Как подключить фильтры можно посмотреть в примерах или документации. Это можно сделать с помощью подключения зависимости и установкой фильтра.